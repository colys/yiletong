<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title></title>
    <link href="http://teaerp.sinaapp.com/MyJS/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://teaerp.sinaapp.com/MyJS/css/bootstrap-theme.min.css" rel="stylesheet">
        
    <link href="http://www.bootcss.com/p/bootstrap-datetimepicker/bootstrap-datetimepicker/css/datetimepicker.css" rel="stylesheet">
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->


</head>
<body>
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">交易查询</h3>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-sm-2"><input type="text" placeholder="终端号" id="termId" /></div>
                <div class="col-sm-2"><input type="text" class="form_datetime" placeholder="起始日期" id="startDate" /> </div>
                <div class="col-sm-2"><input type="text" class="form_datetime" placeholder="结束日期" id="endDate" /></div>
                <div class="col-sm-2"><button type="button" class="btn btn-default" id="btnQuery">查询</button></div>


            </div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover table-responsive"  id="listTable">
            <thead>
                <tr>
                    <th colname="id">流水号</th>
                    <th colname="createDate">系统结算时间</th>
                    <th colname ="terminal">终端号</th>                                        
                    <th colname="batchCount">笔数</th>
                    <th colname="tradeMoney">金额</th>
                    <th colname="discountMoney">Pos手续费</th>
                    <th colname="tixianfeiMoney">T+0</th>       
                    <th colname="statustext">状态</th>
                    <th colname="results">结果</th>
                    <th colname="uploadDate">发起时间</th>
                    <th colname="reciveDate">返回时间</th>                    
                    <th colname="faren">法人</th>
                    <th colname="shanghuName">商户名称</th>
                    <!--<th colname="terminal">结单标志</th>
                    <th colname="terminal">结单时间</th>-->
                </tr>
            </thead>
            <tbody id="customerBody"></tbody>
        </table>
    </div>
    <script type="text/javascript" src="http://teaerp.sinaapp.com/MyJS/js/jquery.min.js"></script>
    <script src="http://teaerp.sinaapp.com/MyJS/js/bootstrap.js"></script>
    <script src="http://teaerp.sinaapp.com/MyJS/js/json.js"></script>
    <script src="http://teaerp.sinaapp.com/MyJS/js/erp.public.js" type="text/javascript"></script>
    <script src="http://www.bootcss.com/p/bootstrap-datetimepicker/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
    <script src="js/main.js" type="text/javascript"></script>
    <script type="text/javascript">

		$(".form_datetime").datetimepicker({format: 'yyyy-mm-dd',minView:2,autoclose:true});
		
		    
		    var entityTable_ops = {
		        table: "transactionSum"
		        //, queryTables: clientEx.getTableName("transactionLogs") + " a join " + clientEx.getTableName("customers") + " b on a.terminal= b.terminal "
		        , queryCols: "*,case status when 0 then '未结' when 1 then '送盘' when 2 then '处理中' when 3 then '结算成功' when -2 then '结算失败' end statustext"
                , editCols: []
                , defaults: { status: 1 }
                , markDelete: true
                , markColName: "status"
		    };
		    var entityTable = $("#listTable").entityTable(entityTable_ops);

		    $("#btnQuery").click(function () {
		        var termId = $("#termId").val().trim();
		        var startDate = $("#startDate").val().trim();
		        var endDate = $("#endDate").val().trim();
		        if (startDate == null || startDate.length < 10) {
		            if (endDate != '') startDate = endDate;
		            else startDate = (new Date()).Format("yyyy-MM-dd");
		        }
		        if (endDate == null || endDate.length < 10) {
		            if (startDate != '') endDate = startDate;
		            else endDate = (new Date()).Format("yyyy-MM-dd");
		        }
		        startDate = strToDate(startDate).AddDays(-1).Format("yyyy-MM-dd");
		        var filter = "createDate between '" + startDate + " 23:00:00' and '" + endDate + " 23:59:59'";
		        if (termId != "") { filter += " and terminal='" + termId + "'" }

		        entityTable.Query(filter, null, true);
		    })

		    $("#btnQuery").click();

       
    </script>
</body>
</html>